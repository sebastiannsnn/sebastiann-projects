<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News - Cycle Owls Student Club</title>
    <link rel="stylesheet" href="News.css">
    <style>
        .future-news {
            background-color: lightgrey;
            opacity: 0.7;
        }

        .news-item {
            width: 60%;
            margin: 10px auto;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 10px;
            background-color: white;
            word-wrap: break-word;
            overflow: hidden;
        }

        .news-item h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        .news-meta {
            font-size: 0.9em;
            color: #555;
        }

        .news-item p {
            font-size: 1em;
            margin-bottom: 10px;
        }

        .news-item button {
            background-color: red;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        .news-item button:hover {
            background-color: darkred;
        }

        .news-content button {
            background-color: green;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .news-content button:hover {
            background-color: darkgreen;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <img src="cycle_owls.png" alt="Cycle Owls Logo">
            </div>
            <nav class="nav-menu">
                <div class="burger-menu" id="burger-menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <div class="menu-text" id="menu-text">Menu</div>
                <ul class="menu-items" id="menu-items">
                    <li><a href="CYCLE OWLS.html">Home</a></li>
                    <li><a href="About.html">About</a></li>
                    <li><a href="Rides.html">Ride Events</a></li>
                    <li><a href="Other.html">Other Events</a></li>
                    <li><a href="News.html">News</a></li>
                    <li><a href="Membership.html">Membership</a></li>
                </ul>
            </nav>
        </div>
    </header>
    <section class="news-section">
        <div class="news-content">
            <button onclick="openAdminLogin()">Add News</button>
            <h2>Latest News</h2>
            <div id="news-list">
                <!-- News items will be dynamically inserted here -->
            </div>
        </div>
    </section>

    <!-- Modal form for admin login -->
    <div id="adminLoginModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAdminLogin()">&times;</span>
            <h2>Admin Login</h2>
            <form id="adminLoginForm" onsubmit="return adminLogin(event)">
                <label for="adminPassword">Password:</label>
                <input type="password" id="adminPassword" required>
                <button type="submit">Login</button>
            </form>
        </div>
    </div>

    <!-- Modal form for adding news -->
    <div id="addNewsFormModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAddNewsForm()">&times;</span>
            <h2>Add News</h2>
            <form id="addNewsForm" onsubmit="return submitAddNewsForm(event)">
                <label for="subject">Subject (max 5 words):</label>
                <input type="text" id="subject" name="subject" required>
                
                <label for="admin">Admin Full Name:</label>
                <input type="text" id="admin" name="admin" required>
                
                <label for="first_showing">First Showing Date:</label>
                <input type="date" id="first_showing" name="first_showing" required>
                
                <label for="last_showing">Last Showing Date:</label>
                <input type="date" id="last_showing" name="last_showing" required>
                
                <label for="content">Content (max 200 words):</label>
                <textarea id="content" name="content" required></textarea>
                
                <button type="submit">Add News</button>
            </form>
        </div>
    </div>

    <!-- Modal form for deleting news -->
    <div id="deleteNewsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeDeleteNewsModal()">&times;</span>
            <h2>Confirm Deletion</h2>
            <form id="deleteNewsForm" onsubmit="return confirmDeleteNews(event)">
                <label for="deletePassword">Password:</label>
                <input type="password" id="deletePassword" required>
                <input type="hidden" id="newsIdToDelete">
                <button type="submit">Delete</button>
            </form>
        </div>
    </div>

    <script>
        document.getElementById('burger-menu').addEventListener('click', function() {
            var menuItems = document.getElementById('menu-items');
            if (menuItems.style.display === 'flex') {
                menuItems.style.display = 'none';
            } else {
                menuItems.style.display = 'flex';
            }
        });

        function openAdminLogin() {
            document.getElementById("adminLoginModal").style.display = "block";
        }

        function closeAdminLogin() {
            document.getElementById("adminLoginModal").style.display = "none";
        }

        function adminLogin(event) {
            event.preventDefault();
            const password = document.getElementById('adminPassword').value;
            if (password === '12345') {
                closeAdminLogin();
                openAddNewsForm();
            } else {
                alert('Incorrect password');
            }
        }

        function openAddNewsForm() {
            document.getElementById("addNewsFormModal").style.display = "block";
        }

        function closeAddNewsForm() {
            document.getElementById("addNewsFormModal").style.display = "none";
        }

        function submitAddNewsForm(event) {
            event.preventDefault();
            const subject = document.getElementById('subject').value.trim().split(' ').length;
            const content = document.getElementById('content').value.trim().split(/\s+/).length;

            if (subject > 5) {
                alert('Subject must be a maximum of 5 words.');
                return false;
            }

            if (content > 200) {
                alert('Content must be a maximum of 200 words.');
                return false;
            }

            const formData = new FormData(document.getElementById("addNewsForm"));
            fetch('add_news.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    closeAddNewsForm();
                    location.reload(); // Reload the page to see the new news item
                } else {
                    alert('Error adding news: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while adding news.');
            });
        }

        function openDeleteNewsModal(newsId) {
            document.getElementById("newsIdToDelete").value = newsId;
            document.getElementById("deleteNewsModal").style.display = "block";
        }

        function closeDeleteNewsModal() {
            document.getElementById("deleteNewsModal").style.display = "none";
        }

        function confirmDeleteNews(event) {
            event.preventDefault();
            const password = document.getElementById('deletePassword').value;
            const newsId = document.getElementById('newsIdToDelete').value;
            if (password === '12345') {
                deleteNews(newsId);
                closeDeleteNewsModal();
            } else {
                alert('Incorrect password');
            }
        }

        function deleteNews(newsId) {
            fetch('delete_news.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ newsId: newsId })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload(); // Reload the page to see the updated news list
                } else {
                    alert('Error deleting news: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while deleting news.');
            });
        }

        // Fetch and display news items
        fetch('get_news.php')
        .then(response => response.json())
        .then(data => {
            const newsList = document.getElementById('news-list');
            const currentDate = new Date();

            // Sort news items: active ones first, then future ones
            const activeNews = data.filter(news => new Date(news.first_showing) <= currentDate);
            const futureNews = data.filter(news => new Date(news.first_showing) > currentDate);

            // Append active news items
            activeNews.forEach(news => {
                const newsItem = document.createElement('div');
                newsItem.className = 'news-item';
                newsItem.innerHTML = `
                    <h3>${news.subject}</h3>
                    <p class="news-meta"><strong>Posted by:</strong> ${news.admin}</p>
                    <p class="news-meta"><strong>First Showing:</strong> ${news.first_showing}</p>
                    <p class="news-meta"><strong>Last Showing:</strong> ${news.last_showing}</p>
                    <p>${news.content}</p>
                    <button onclick="openDeleteNewsModal(${news.id})">Delete</button>
                `;
                newsList.appendChild(newsItem);
            });

            // Append future news items with different styling
            futureNews.forEach(news => {
                const newsItem = document.createElement('div');
                newsItem.className = 'news-item future-news';
                newsItem.innerHTML = `
                    <h3>${news.subject}</h3>
                    <p class="news-meta"><strong>Posted by:</strong> ${news.admin}</p>
                    <p class="news-meta"><strong>First Showing:</strong> ${news.first_showing}</p>
                    <p class="news-meta"><strong>Last Showing:</strong> ${news.last_showing}</p>
                    <p>${news.content}</p>
                    <button onclick="openDeleteNewsModal(${news.id})">Delete</button>
                `;
                newsList.appendChild(newsItem);
            });
        });
    </script>
</body>
</html>
