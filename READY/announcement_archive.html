<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Announcement Archive - Cycle Owls Student Club</title>
    <link rel="stylesheet" href="Membership.css">
    <style>
        .announcement-content h2 {
            text-align: center;
        }
        .announcement-item {
            border: 1px solid #ccc;
            padding: 10px;
            margin: 10px 0;
            position: relative;
        }
        .delete-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: red;
            color: white;
            border: none;
            padding: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <img src="cycle_owls.png" alt="Cycle Owls Logo">
            </div>
            <nav class="nav-menu">
                <div class="burger-menu" id="burger-menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <div class="menu-text" id="menu-text">Menu</div>
                <ul class="menu-items" id="menu-items">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="Rides.html">Ride Events</a></li>
                    <li><a href="Other.html">Other Events</a></li>
                    <li><a href="News.html">News</a></li>
                    <li><a href="Membership.html">Membership</a></li>
                </ul>
            </nav>
        </div>
    </header>
    <section class="announcement-section">
        <div class="announcement-content">
            <h2>Announcement Archive</h2>
            <div id="announcement-list">
                <!-- Announcement list will be dynamically inserted here -->
            </div>
        </div>
    </section>

    <script>
        document.getElementById('burger-menu').addEventListener('click', function() {
            var menuItems = document.getElementById('menu-items');
            menuItems.style.display = menuItems.style.display === 'flex' ? 'none' : 'flex';
        });

        function fetchAnnouncements() {
            fetch('announcement_archive.php')
                .then(response => response.json())
                .then(data => {
                    const announcementList = document.getElementById('announcement-list');
                    announcementList.innerHTML = ''; // Clear previous content
                    data.forEach(announcement => {
                        const announcementItem = document.createElement('div');
                        announcementItem.className = 'announcement-item';
                        announcementItem.innerHTML = `
                            <p><strong>Date:</strong> ${announcement.created_at}</p>
                            <p><strong>Subject:</strong> ${announcement.subject}</p>
                            <p><strong>Recipients:</strong> ${announcement.recipientCount}</p>
                            <p>${announcement.message}</p>
                            <button class="delete-button" onclick="deleteAnnouncement(${announcement.id})">Delete</button>
                        `;
                        announcementList.appendChild(announcementItem);
                    });
                })
                .catch(error => {
                    console.error('Error fetching announcements:', error);
                });
        }

        function deleteAnnouncement(id) {
            if (confirm('Are you sure you want to delete this announcement?')) {
                fetch('announcement_archive.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        'action': 'delete',
                        'id': id
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        fetchAnnouncements(); // Refresh the announcement list
                    } else {
                        alert('Error deleting announcement: ' + (data.error || 'Unknown error'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while deleting the announcement.');
                });
            }
        }

        // Fetch announcements on page load
        fetchAnnouncements();
    </script>
</body>
</html>
