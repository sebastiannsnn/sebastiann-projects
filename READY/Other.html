<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Other Events - Cycle Owls Student Club</title>
    <link rel="stylesheet" href="Other.css">
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <img src="cycle_owls.png" alt="Cycle Owls Logo">
            </div>
            <nav class="nav-menu">
                <div class="burger-menu" id="burger-menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <div class="menu-text" id="menu-text">Menu</div>
                <ul class="menu-items" id="menu-items">
                    <li><a href="CYCLE OWLS.html">Home</a></li>
                    <li><a href="About.html">About</a></li>
                    <li><a href="Rides.html">Ride Events</a></li>
                    <li><a href="Other.html">Other Events</a></li>
                    <li><a href="News.html">News</a></li>
                    <li><a href="Membership.html">Membership</a></li>
                </ul>
            </nav>
        </div>
    </header>
    <section class="other-events-intro">
        <div class="intro-content">
            <div class="title">
                <h1>Other Events</h1>
            </div>
            <div class="description">
                <p>The club tries to encourage greater interaction between members through a series of social events. These events will be publicised on the club website but will be added using the admin application.</p>
                <button onclick="openAdminLogin()">Add Event</button>
            </div>
        </div>
    </section>
    <section class="other-events">
        <div class="events-content" id="events-content">
            <!-- Events will be dynamically inserted here -->
        </div>
    </section>
    <footer class="footer">
        <div class="footer-content">
            <p>BECOME A CYCLING OWL! KEEP UP TO DATE AND SHARE YOUR PASSION FOR SCIENCE AND CYCLING WITH US. <a href="#">JOIN NOW!</a></p>
        </div>
    </footer>

    <!-- Modal form for admin login -->
    <div id="adminLoginModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAdminLogin()">&times;</span>
            <h2>Admin Login</h2>
            <form id="adminLoginForm" onsubmit="return adminLogin(event)">
                <label for="adminPassword">Password:</label>
                <input type="password" id="adminPassword" autocomplete="new-password" required>
                <button type="submit">Login</button>
            </form>
        </div>
    </div>

    <!-- Modal form for adding events -->
    <div id="eventFormModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeForm()">&times;</span>
            <h2>Add Other Event</h2>
            <form id="eventForm" action="add_other_event.php" method="POST">
                <label for="name">Name of Event:</label>
                <input type="text" id="name" name="name" autocomplete="off" required>
                
                <label for="type">Type of Event:</label>
                <select id="type" name="type" autocomplete="off" required>
                    <option value="family">Family</option>
                    <option value="study">Study</option>
                    <option value="party">Party</option>
                </select>
                
                <label for="date">Date of Event:</label>
                <input type="date" id="date" name="date" autocomplete="off" required>
                
                <label for="time">Start Time:</label>
                <input type="time" id="time" name="time" autocomplete="off" required>
                
                <label for="duration">Duration (mins):</label>
                <input type="number" id="duration" name="duration" autocomplete="off" required>
                
                <label for="location">Location:</label>
                <input type="text" id="location" name="location" autocomplete="off" required>
                
                <label for="comments">Comments:</label>
                <textarea id="comments" name="comments" autocomplete="off"></textarea>
                
                <button type="submit">Add Event</button>
            </form>
        </div>
    </div>

    <!-- Modal form for editing events -->
    <div id="editEventFormModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditForm()">&times;</span>
            <h2>Edit Other Event</h2>
            <form id="editEventForm">
                <input type="hidden" id="editEventId" name="eventId" autocomplete="off">
                <label for="editName">Name of Event:</label>
                <input type="text" id="editName" name="name" autocomplete="off" required>
                
                <label for="editType">Type of Event:</label>
                <select id="editType" name="type" autocomplete="off" required>
                    <option value="family">Family</option>
                    <option value="study">Study</option>
                    <option value="party">Party</option>
                </select>
                
                <label for="editDate">Date of Event:</label>
                <input type="date" id="editDate" name="date" autocomplete="off" required>
                
                <label for="editTime">Start Time:</label>
                <input type="time" id="editTime" name="time" autocomplete="off" required>
                
                <label for="editDuration">Duration (mins):</label>
                <input type="number" id="editDuration" name="duration" autocomplete="off" required>
                
                <label for="editLocation">Location:</label>
                <input type="text" id="editLocation" name="location" autocomplete="off" required>
                
                <label for="editComments">Comments:</label>
                <textarea id="editComments" name="comments" autocomplete="off"></textarea>
                
                <button type="submit">Save Changes</button>
            </form>
        </div>
    </div>

    <script>
        document.getElementById('burger-menu').addEventListener('click', function() {
            var menuItems = document.getElementById('menu-items');
            if (menuItems.style.display === 'flex') {
                menuItems.style.display = 'none';
            } else {
                menuItems.style.display = 'flex';
            }
        });

        function openForm() {
            document.getElementById("eventFormModal").style.display = "block";
        }

        function closeForm() {
            document.getElementById("eventFormModal").style.display = "none";
        }

        function openEditForm(event) {
            document.getElementById("editEventId").value = event.id;
            document.getElementById("editName").value = event.name;
            document.getElementById("editType").value = event.type;
            document.getElementById("editDate").value = event.date;
            document.getElementById("editTime").value = event.time;
            document.getElementById("editDuration").value = event.duration;
            document.getElementById("editLocation").value = event.location;
            document.getElementById("editComments").value = event.comments;

            document.getElementById("editEventFormModal").style.display = "block";
        }

        function closeEditForm() {
            document.getElementById("editEventFormModal").style.display = "none";
        }

        function openAdminLogin() {
            document.getElementById("adminLoginModal").style.display = "block";
        }

        function closeAdminLogin() {
            document.getElementById("adminLoginModal").style.display = "none";
        }

        function adminLogin(event) {
            event.preventDefault();
            const password = document.getElementById('adminPassword').value;
            if (password === '12345') {
                closeAdminLogin();
                openForm();
            } else {
                alert('Incorrect password');
            }
        }

        function adminEdit(event) {
            const password = prompt("Enter admin password to edit:");
            if (password === '12345') {
                openEditForm(event);
            } else {
                alert('Incorrect password');
            }
        }

        function updateEvents(events) {
            const eventsContent = document.getElementById('events-content');
            eventsContent.innerHTML = ''; // Clear existing content
            events.forEach(event => {
                const eventCard = document.createElement('div');
                const eventDate = new Date(event.date);
                const currentDate = new Date();
                const isPast = eventDate < currentDate;

                eventCard.className = `event-card ${event.type}`;
                if (isPast) {
                    eventCard.style.backgroundColor = 'lightgrey';
                }
                eventCard.innerHTML = `
                    <p>${event.date}</p>
                    <p>${event.location}</p>
                `;
                eventCard.addEventListener('click', () => {
                    const details = `
                        Name: ${event.name}\n
                        Type: ${event.type}\n
                        Date: ${event.date}\n
                        Time: ${event.time}\n
                        Duration: ${event.duration} mins\n
                        Location: ${event.location}\n
                        Comments: ${event.comments}
                    `;
                    alert(details);
                    if (confirm("Do you want to edit this event?")) {
                        adminEdit({
                            id: event.id,
                            name: event.name,
                            type: event.type,
                            date: event.date,
                            time: event.time,
                            duration: event.duration,
                            location: event.location,
                            comments: event.comments
                        });
                    }
                });
                eventsContent.appendChild(eventCard);
            });
        }

        // Fetch and display events
        fetch('get_other_events.php')
        .then(response => response.json())
        .then(data => {
            data.sort((a, b) => new Date(a.date) - new Date(b.date)); // Sort events by date
            updateEvents(data);
        });

        document.getElementById("editEventForm").addEventListener("submit", function (event) {
            event.preventDefault();
            const formData = new FormData(this);
            fetch('edit_other_event.php', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(errorData => {
                        throw new Error(errorData.error);
                    });
                }
                return response.json();
            })
            .then(data => {
                closeEditForm();
                data.sort((a, b) => new Date(a.date) - new Date(b.date)); // Sort events by date
                updateEvents(data);
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while saving the changes: ' + error.message);
            });
        });
    </script>
</body>
</html>
